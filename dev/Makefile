# ì•”í˜¸í™”í ê±°ë˜ì†Œ ì›¹ì†Œì¼“ ì—°ê²° ìë™í™” Makefile
# 10ê°œ ê±°ë˜ì†Œë¥¼ ì§€ì—­ë³„ë¡œ ë³‘ë ¬ ì‹¤í–‰
#
# ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ (Coinone, Huobi):
#   - ì—¬ëŸ¬ ì‹¬ë³¼ ìš”ì²­ ì‹œ ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ê°œë³„ ì—°ê²° ìƒì„±
#   - ì˜ˆ: SYMBOLS=BTC,ETH,XRP â†’ 3ê°œì˜ ë…ë¦½ì ì¸ WebSocket ì—°ê²°
#   - Redis í‚¤: ws:connection:coinone:korea:ticker:BTC (ì‹¬ë³¼ í¬í•¨)

.PHONY: help all korea asia na eu clean stop ticker orderbook trade batch-test consumer-start consumer-stop \
	all-ticker all-orderbook all-trade korea-ticker korea-orderbook korea-trade \
	asia-ticker asia-orderbook asia-trade na-ticker na-orderbook na-trade \
	eu-ticker eu-orderbook eu-trade upbit-ticker upbit-orderbook upbit-trade \
	bithumb-ticker bithumb-orderbook bithumb-trade coinone-ticker coinone-orderbook coinone-trade \
	korbit-ticker korbit-orderbook korbit-trade \
	binance-ticker binance-orderbook binance-trade \
	huobi-ticker huobi-orderbook huobi-trade \
	bybit-ticker bybit-orderbook bybit-trade \
	okx-ticker okx-orderbook okx-trade \
	coinbase-ticker coinbase-orderbook coinbase-trade kraken-ticker kraken-orderbook kraken-trade \
	bitfinex-ticker bitfinex-orderbook bitfinex-trade

# ê¸°ë³¸ ì„¤ì •
PYTHON := PYTHONPATH=.. python
SYMBOLS := BTC,ETH,XRP
REQUEST_TYPE := ticker
SUBSCRIBE_TYPE := ticker

# ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸ìš© ì„¤ì •
TEST_SYMBOLS := BTC
TEST_EXCHANGE := upbit
TEST_REGION := korea

# ìƒ‰ìƒ ì •ì˜
GREEN := \033[0;32m
YELLOW := \033[1;33m
RED := \033[0;31m
NC := \033[0m # No Color

help: ## ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í‘œì‹œ
	@echo "$(GREEN)ì•”í˜¸í™”í ê±°ë˜ì†Œ ì›¹ì†Œì¼“ ì—°ê²° ìë™í™”$(NC)"
	@echo ""
	@echo "$(YELLOW)ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:$(NC)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  $(GREEN)%-15s$(NC) %s\n", $$1, $$2}' $(MAKEFILE_LIST)

all: ## ëª¨ë“  ê±°ë˜ì†Œ + ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… ì—°ê²° (ticker, orderbook, trade)
	@echo "$(GREEN)ğŸš€ ëª¨ë“  ê±°ë˜ì†Œ + ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… ì—°ê²° ì‹œì‘...$(NC)"
	@$(MAKE) all-ticker &
	@$(MAKE) all-orderbook &
	@$(MAKE) all-trade &
	@echo "$(YELLOW)ëª¨ë“  ê±°ë˜ì†Œ + ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… ë³‘ë ¬ ì‹¤í–‰ ì¤‘... Ctrl+Cë¡œ ì¤‘ë‹¨$(NC)"
	@wait

# ëª¨ë“  ê±°ë˜ì†Œ + ë©”ì‹œì§€ íƒ€ì…ë³„ ì—°ê²°
all-ticker: ## ëª¨ë“  ê±°ë˜ì†Œ ticker ì—°ê²°
	@echo "$(GREEN)ğŸ“Š ëª¨ë“  ê±°ë˜ì†Œ ticker ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) korea-ticker &
	@$(MAKE) asia-ticker &
	@$(MAKE) na-ticker &
	@$(MAKE) eu-ticker &
	@wait

all-orderbook: ## ëª¨ë“  ê±°ë˜ì†Œ orderbook ì—°ê²°
	@echo "$(GREEN)ğŸ“ˆ ëª¨ë“  ê±°ë˜ì†Œ orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) korea-orderbook &
	@$(MAKE) asia-orderbook &
	@$(MAKE) na-orderbook &
	@$(MAKE) eu-orderbook &
	@wait

all-trade: ## ëª¨ë“  ê±°ë˜ì†Œ trade ì—°ê²°
	@echo "$(GREEN)ğŸ’° ëª¨ë“  ê±°ë˜ì†Œ trade ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) korea-trade &
	@$(MAKE) asia-trade &
	@$(MAKE) na-trade &
	@$(MAKE) eu-trade &
	@wait

korea: ## í•œêµ­ ê±°ë˜ì†Œ ì—°ê²° (4ê°œ) - tickerë§Œ
	@echo "$(GREEN)ğŸ‡°ğŸ‡· í•œêµ­ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) upbit &
	@$(MAKE) bithumb &
	@$(MAKE) coinone &  # ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ - ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@$(MAKE) korbit &
	@wait

# ì§€ì—­ë³„ + ë©”ì‹œì§€ íƒ€ì…ë³„ ì—°ê²°
korea-ticker: ## í•œêµ­ ê±°ë˜ì†Œ ticker ì—°ê²°
	@$(MAKE) upbit-ticker &
	@$(MAKE) bithumb-ticker &
	@$(MAKE) coinone-ticker &
	@$(MAKE) korbit-ticker &
	@wait

korea-orderbook: ## í•œêµ­ ê±°ë˜ì†Œ orderbook ì—°ê²°
	@$(MAKE) upbit-orderbook &
	@$(MAKE) bithumb-orderbook &
	@$(MAKE) coinone-orderbook &
	@$(MAKE) korbit-orderbook &
	@wait

korea-trade: ## í•œêµ­ ê±°ë˜ì†Œ trade ì—°ê²°
	@$(MAKE) upbit-trade &
	@$(MAKE) bithumb-trade &
	@$(MAKE) coinone-trade &
	@$(MAKE) korbit-trade &
	@wait

asia: ## ì•„ì‹œì•„ ê±°ë˜ì†Œ ì—°ê²° (4ê°œ) - tickerë§Œ
	@echo "$(GREEN)ğŸŒ ì•„ì‹œì•„ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) binance &
	@$(MAKE) huobi &  # ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ - ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@$(MAKE) bybit &
	@$(MAKE) okx &
	@wait

asia-ticker: ## ì•„ì‹œì•„ ê±°ë˜ì†Œ ticker ì—°ê²°
	@$(MAKE) binance-ticker &
	@$(MAKE) huobi-ticker &
	@$(MAKE) bybit-ticker &
	@$(MAKE) okx-ticker &
	@wait

asia-orderbook: ## ì•„ì‹œì•„ ê±°ë˜ì†Œ orderbook ì—°ê²°
	@$(MAKE) binance-orderbook &
	@$(MAKE) huobi-orderbook &
	@$(MAKE) bybit-orderbook &
	@$(MAKE) okx-orderbook &
	@wait

asia-trade: ## ì•„ì‹œì•„ ê±°ë˜ì†Œ trade ì—°ê²°
	@$(MAKE) binance-trade &
	@$(MAKE) huobi-trade &
	@$(MAKE) bybit-trade &
	@$(MAKE) okx-trade &
	@wait

na: ## ë¶ë¯¸ ê±°ë˜ì†Œ ì—°ê²° (2ê°œ) - tickerë§Œ
	@echo "$(GREEN)ğŸ‡ºğŸ‡¸ ë¶ë¯¸ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) coinbase &
	@$(MAKE) kraken &
	@wait

na-ticker: ## ë¶ë¯¸ ê±°ë˜ì†Œ ticker ì—°ê²°
	@$(MAKE) coinbase-ticker &
	@$(MAKE) kraken-ticker &
	@wait

na-orderbook: ## ë¶ë¯¸ ê±°ë˜ì†Œ orderbook ì—°ê²°
	@$(MAKE) coinbase-orderbook &
	@$(MAKE) kraken-orderbook &
	@wait

na-trade: ## ë¶ë¯¸ ê±°ë˜ì†Œ trade ì—°ê²°
	@$(MAKE) coinbase-trade &
	@$(MAKE) kraken-trade &
	@wait

# eu: ## ìœ ëŸ½ ê±°ë˜ì†Œ ì—°ê²° (1ê°œ) - tickerë§Œ
# 	@echo "$(GREEN)ğŸ‡ªğŸ‡º ìœ ëŸ½ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
# 	@$(MAKE) bitfinex

# eu-ticker: ## ìœ ëŸ½ ê±°ë˜ì†Œ ticker ì—°ê²°
# 	@$(MAKE) bitfinex-ticker

# eu-orderbook: ## ìœ ëŸ½ ê±°ë˜ì†Œ orderbook ì—°ê²°
# 	@$(MAKE) bitfinex-orderbook

# eu-trade: ## ìœ ëŸ½ ê±°ë˜ì†Œ trade ì—°ê²°
# 	@$(MAKE) bitfinex-trade

# í•œêµ­ ê±°ë˜ì†Œë“¤
upbit: ## Upbit ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Upbit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

upbit-ticker: ## Upbit ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Upbit ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

upbit-orderbook: ## Upbit orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Upbit orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type orderbook \
		--subscribe-type orderbook

upbit-trade: ## Upbit trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Upbit trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type trade \
		--subscribe-type trade

bithumb: ## Bithumb ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Bithumb ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bithumb \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

bithumb-ticker: ## Bithumb ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Bithumb ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bithumb \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

bithumb-orderbook: ## Bithumb orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Bithumb orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bithumb \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type orderbook \
		--subscribe-type orderbook

bithumb-trade: ## Bithumb trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Bithumb trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bithumb \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type trade \
		--subscribe-type trade

coinone: ## Coinone ì—°ê²° (ticker) - ë‹¨ì¼ êµ¬ë…: ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@echo "$(YELLOW)ğŸ“ˆ Coinone ì—°ê²° ì¤‘... (ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ)$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinone \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

coinone-ticker: ## Coinone ticker ì—°ê²° - ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@echo "$(YELLOW)ğŸ“Š Coinone ticker ì—°ê²° ì¤‘... (ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ)$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinone \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

coinone-orderbook: ## Coinone orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Coinone orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinone \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type orderbook \
		--subscribe-type orderbook

coinone-trade: ## Coinone trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Coinone trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinone \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type trade \
		--subscribe-type trade

korbit: ## Korbit ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Korbit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange korbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

korbit-ticker: ## Korbit ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Korbit ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange korbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

korbit-orderbook: ## Korbit orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Korbit orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange korbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type orderbook \
		--subscribe-type orderbook

korbit-trade: ## Korbit trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Korbit trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange korbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type trade \
		--subscribe-type trade

# gopax: ## Gopax ì—°ê²° (ticker) - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“ˆ Gopax ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange gopax \
# 		--symbols $(SYMBOLS) \
# 		--region korea \
# 		--request-type $(REQUEST_TYPE) \
# 		--subscribe-type $(SUBSCRIBE_TYPE)

# gopax-ticker: ## Gopax ticker ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“Š Gopax ticker ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange gopax \
# 		--symbols $(SYMBOLS) \
# 		--region korea \
# 		--request-type ticker \
# 		--subscribe-type ticker

# gopax-orderbook: ## Gopax orderbook ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“ˆ Gopax orderbook ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange gopax \
# 		--symbols $(SYMBOLS) \
# 		--region korea \
# 		--request-type orderbook \
# 		--subscribe-type orderbook

# gopax-trade: ## Gopax trade ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ’° Gopax trade ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange gopax \
# 		--symbols $(SYMBOLS) \
# 		--region korea \
# 		--request-type trade \
# 		--subscribe-type trade

# ì•„ì‹œì•„ ê±°ë˜ì†Œë“¤
binance: ## Binance ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Binance ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange binance \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

binance-ticker: ## Binance ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Binance ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange binance \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type ticker \
		--subscribe-type ticker

binance-orderbook: ## Binance orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Binance orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange binance \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type orderbook \
		--subscribe-type orderbook

binance-trade: ## Binance trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Binance trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange binance \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type trade \
		--subscribe-type trade

huobi: ## Huobi ì—°ê²° (ticker) - ë‹¨ì¼ êµ¬ë…: ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@echo "$(YELLOW)ğŸ“ˆ Huobi ì—°ê²° ì¤‘... (ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ)$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange huobi \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

huobi-ticker: ## Huobi ticker ì—°ê²° - ìë™ìœ¼ë¡œ ì‹¬ë³¼ë³„ ì—°ê²° ë¶„ë¦¬
	@echo "$(YELLOW)ğŸ“Š Huobi ticker ì—°ê²° ì¤‘... (ë‹¨ì¼ êµ¬ë… ê±°ë˜ì†Œ)$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange huobi \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type ticker \
		--subscribe-type ticker

huobi-orderbook: ## Huobi orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Huobi orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange huobi \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type orderbook \
		--subscribe-type orderbook

huobi-trade: ## Huobi trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Huobi trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange huobi \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type trade \
		--subscribe-type trade

# mexc: ## MEXC ì—°ê²° (ticker) - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“ˆ MEXC ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange mexc \
# 		--symbols $(SYMBOLS) \
# 		--region asia \
# 		--request-type $(REQUEST_TYPE) \
# 		--subscribe-type $(SUBSCRIBE_TYPE)

# mexc-ticker: ## MEXC ticker ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“Š MEXC ticker ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange mexc \
# 		--symbols $(SYMBOLS) \
# 		--region asia \
# 		--request-type ticker \
# 		--subscribe-type ticker

# mexc-orderbook: ## MEXC orderbook ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ“ˆ MEXC orderbook ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange mexc \
# 		--symbols $(SYMBOLS) \
# 		--region asia \
# 		--request-type orderbook \
# 		--subscribe-type orderbook

# mexc-trade: ## MEXC trade ì—°ê²° - ì œê±°ë¨
# 	@echo "$(YELLOW)ğŸ’° MEXC trade ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange mexc \
# 		--symbols $(SYMBOLS) \
# 		--region asia \
# 		--request-type trade \
# 		--subscribe-type trade

bybit: ## Bybit ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Bybit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bybit \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

bybit-ticker: ## Bybit ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Bybit ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bybit \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type ticker \
		--subscribe-type ticker

bybit-orderbook: ## Bybit orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Bybit orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bybit \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type orderbook \
		--subscribe-type orderbook

bybit-trade: ## Bybit trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Bybit trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bybit \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type trade \
		--subscribe-type trade

gateio: ## Gate.io ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Gate.io ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange gateio \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

gateio-ticker: ## Gate.io ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Gate.io ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange gateio \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type ticker \
		--subscribe-type ticker

gateio-orderbook: ## Gate.io orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Gate.io orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange gateio \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type orderbook \
		--subscribe-type orderbook

gateio-trade: ## Gate.io trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Gate.io trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange gateio \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type trade \
		--subscribe-type trade

okx: ## OKX ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ OKX ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange okx \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

okx-ticker: ## OKX ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š OKX ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange okx \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type ticker \
		--subscribe-type ticker

okx-orderbook: ## OKX orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ OKX orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange okx \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type orderbook \
		--subscribe-type orderbook

okx-trade: ## OKX trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° OKX trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange okx \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type trade \
		--subscribe-type trade

# ë¶ë¯¸ ê±°ë˜ì†Œë“¤
coinbase: ## Coinbase ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Coinbase ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinbase \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

coinbase-ticker: ## Coinbase ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Coinbase ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinbase \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type ticker \
		--subscribe-type ticker

coinbase-orderbook: ## Coinbase orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Coinbase orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinbase \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type orderbook \
		--subscribe-type orderbook

coinbase-trade: ## Coinbase trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Coinbase trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinbase \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type trade \
		--subscribe-type trade

kraken: ## Kraken ì—°ê²° (ticker)
	@echo "$(YELLOW)ğŸ“ˆ Kraken ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange kraken \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

kraken-ticker: ## Kraken ticker ì—°ê²°
	@echo "$(YELLOW)ğŸ“Š Kraken ticker ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange kraken \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type ticker \
		--subscribe-type ticker

kraken-orderbook: ## Kraken orderbook ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Kraken orderbook ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange kraken \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type orderbook \
		--subscribe-type orderbook

kraken-trade: ## Kraken trade ì—°ê²°
	@echo "$(YELLOW)ğŸ’° Kraken trade ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange kraken \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type trade \
		--subscribe-type trade

# ìœ ëŸ½ ê±°ë˜ì†Œë“¤
# bitfinex: ## Bitfinex ì—°ê²° (ticker)
# 	@echo "$(YELLOW)ğŸ“ˆ Bitfinex ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange bitfinex \
# 		--symbols $(SYMBOLS) \
# 		--region eu \
# 		--request-type $(REQUEST_TYPE) \
# 		--subscribe-type $(SUBSCRIBE_TYPE)

# bitfinex-ticker: ## Bitfinex ticker ì—°ê²°
# 	@echo "$(YELLOW)ğŸ“Š Bitfinex ticker ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange bitfinex \
# 		--symbols $(SYMBOLS) \
# 		--region eu \
# 		--request-type ticker \
# 		--subscribe-type ticker

# bitfinex-orderbook: ## Bitfinex orderbook ì—°ê²°
# 	@echo "$(YELLOW)ğŸ“ˆ Bitfinex orderbook ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange bitfinex \
# 		--symbols $(SYMBOLS) \
# 		--region eu \
# 		--request-type orderbook \
# 		--subscribe-type orderbook

# bitfinex-trade: ## Bitfinex trade ì—°ê²°
# 	@echo "$(YELLOW)ğŸ’° Bitfinex trade ì—°ê²° ì¤‘...$(NC)"
# 	@$(PYTHON) producer_main.py \
# 		--exchange bitfinex \
# 		--symbols $(SYMBOLS) \
# 		--region eu \
# 		--request-type trade \
# 		--subscribe-type trade

# ìœ í‹¸ë¦¬í‹° ëª…ë ¹ì–´ë“¤
test: ## ë‹¨ì¼ ê±°ë˜ì†Œ í…ŒìŠ¤íŠ¸ (Upbit)
	@echo "$(GREEN)ğŸ§ª Upbit í…ŒìŠ¤íŠ¸ ì—°ê²°...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols BTC \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

status: ## Kafka Consumer ìƒíƒœ í™•ì¸
	@echo "$(GREEN)ğŸ“Š Kafka Consumer ìƒíƒœ í™•ì¸...$(NC)"
	@$(PYTHON) main.py &
	@sleep 5
	@pkill -f "python main.py" || true

clean: ## ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
	@echo "$(RED)ğŸ§¹ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬...$(NC)"
	@pkill -f "producer_main.py" || true
	@pkill -f "main.py" || true
	@echo "$(GREEN)âœ… ì •ë¦¬ ì™„ë£Œ$(NC)"

stop: clean ## ëª¨ë“  í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ (cleanê³¼ ë™ì¼)

# ì„¤ì • ë³€ê²½ ê°€ëŠ¥í•œ íƒ€ê²Ÿë“¤
symbols-btc: ## BTCë§Œ ì—°ê²°
	@$(MAKE) all SYMBOLS=BTC

symbols-major: ## ì£¼ìš” ì½”ì¸ ì—°ê²° (BTC,ETH,XRP)
	@$(MAKE) all SYMBOLS=BTC,ETH,XRP

symbols-all: ## ëª¨ë“  ì½”ì¸ ì—°ê²° (BTC,ETH,XRP,ADA,DOT)
	@$(MAKE) all SYMBOLS=BTC,ETH,XRP,ADA,DOT

# ê°œë°œìš© ëª…ë ¹ì–´ë“¤
dev-korea: ## ê°œë°œìš©: í•œêµ­ ê±°ë˜ì†Œë§Œ ìˆœì°¨ ì‹¤í–‰
	@echo "$(GREEN)ğŸ”§ ê°œë°œ ëª¨ë“œ: í•œêµ­ ê±°ë˜ì†Œ ìˆœì°¨ ì‹¤í–‰$(NC)"
	@$(MAKE) upbit
	@sleep 2
	@$(MAKE) bithumb
	@sleep 2
	@$(MAKE) coinone
	@sleep 2
	@$(MAKE) korbit

dev-test: ## ê°œë°œìš©: ê° ì§€ì—­ë³„ 1ê°œì”©ë§Œ í…ŒìŠ¤íŠ¸
	@echo "$(GREEN)ğŸ”§ ê°œë°œ ëª¨ë“œ: ì§€ì—­ë³„ í…ŒìŠ¤íŠ¸$(NC)"
	@$(MAKE) upbit &
	@$(MAKE) binance &
	@$(MAKE) coinbase &
	@$(MAKE) bitfinex &
	@wait

# ë©”ì‹œì§€ íƒ€ì…ë³„ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ë“¤
ticker: ## í‹°ì»¤ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (ë°°ì¹˜ ìˆ˜ì§‘ í¬í•¨)
	@echo "$(GREEN)ğŸ“Š í‹°ì»¤ ë©”ì‹œì§€ ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange $(TEST_EXCHANGE) \
		--symbols $(TEST_SYMBOLS) \
		--region $(TEST_REGION) \
		--request-type ticker \
		--subscribe-type ticker

orderbook: ## ì˜¤ë”ë¶ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (ë°°ì¹˜ ìˆ˜ì§‘ í¬í•¨)
	@echo "$(GREEN)ğŸ“ˆ ì˜¤ë”ë¶ ë©”ì‹œì§€ ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange $(TEST_EXCHANGE) \
		--symbols $(TEST_SYMBOLS) \
		--region $(TEST_REGION) \
		--request-type orderbook \
		--subscribe-type orderbook

trade: ## ì²´ê²° ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (ë°°ì¹˜ ìˆ˜ì§‘ í¬í•¨)
	@echo "$(GREEN)ğŸ’° ì²´ê²° ë©”ì‹œì§€ ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange $(TEST_EXCHANGE) \
		--symbols $(TEST_SYMBOLS) \
		--region $(TEST_REGION) \
		--request-type trade \
		--subscribe-type trade

# ë°°ì¹˜ ìˆ˜ì§‘ í†µí•© í…ŒìŠ¤íŠ¸
batch-test: ## ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸ (ìˆœì°¨ ì‹¤í–‰)
	@echo "$(GREEN)ğŸš€ ë°°ì¹˜ ìˆ˜ì§‘ ì‹œìŠ¤í…œ í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘...$(NC)"
	@echo "$(YELLOW)1/3 í‹°ì»¤ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (30ì´ˆ)...$(NC)"
	@timeout 30s $(MAKE) ticker || true
	@sleep 2
	@echo "$(YELLOW)2/3 ì˜¤ë”ë¶ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (30ì´ˆ)...$(NC)"
	@timeout 30s $(MAKE) orderbook || true
	@sleep 2
	@echo "$(YELLOW)3/3 ì²´ê²° ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸ (30ì´ˆ)...$(NC)"
	@timeout 30s $(MAKE) trade || true
	@echo "$(GREEN)âœ… ë°°ì¹˜ ìˆ˜ì§‘ í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ$(NC)"

batch-parallel: ## ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… ë³‘ë ¬ ë°°ì¹˜ í…ŒìŠ¤íŠ¸
	@echo "$(GREEN)âš¡ ë³‘ë ¬ ë°°ì¹˜ ìˆ˜ì§‘ í…ŒìŠ¤íŠ¸ ì‹œì‘...$(NC)"
	@$(MAKE) ticker TEST_EXCHANGE=upbit &
	@$(MAKE) orderbook TEST_EXCHANGE=bithumb &
	@$(MAKE) trade TEST_EXCHANGE=coinone &
	@echo "$(YELLOW)ë³‘ë ¬ ì‹¤í–‰ ì¤‘... Ctrl+Cë¡œ ì¤‘ë‹¨$(NC)"
	@wait

# Consumer ê´€ë¦¬ ëª…ë ¹ì–´ë“¤
consumer-start: ## Kafka Consumer ì‹œì‘ (ë°±ê·¸ë¼ìš´ë“œ)
	@echo "$(GREEN)ğŸ§ Kafka Consumer ì‹œì‘...$(NC)"
	@nohup $(PYTHON) main.py > consumer.log 2>&1 &
	@echo "$(YELLOW)Consumerê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. ë¡œê·¸: consumer.log$(NC)"

consumer-stop: ## Kafka Consumer ì¤‘ë‹¨
	@echo "$(RED)ğŸ›‘ Kafka Consumer ì¤‘ë‹¨...$(NC)"
	@pkill -f "python main.py" || true
	@echo "$(GREEN)âœ… Consumer ì¤‘ë‹¨ ì™„ë£Œ$(NC)"

consumer-logs: ## Consumer ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
	@echo "$(GREEN)ğŸ“‹ Consumer ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸ (Ctrl+Cë¡œ ì¤‘ë‹¨)...$(NC)"
	@tail -f consumer.log 2>/dev/null || echo "$(RED)consumer.log íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. consumer-startë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.$(NC)"

# ê±°ë˜ì†Œë³„ ë©”ì‹œì§€ íƒ€ì… í…ŒìŠ¤íŠ¸
test-upbit-all: ## Upbit ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… í…ŒìŠ¤íŠ¸
	@echo "$(GREEN)ğŸ‡°ğŸ‡· Upbit ì „ì²´ ë©”ì‹œì§€ íƒ€ì… í…ŒìŠ¤íŠ¸...$(NC)"
	@$(MAKE) ticker TEST_EXCHANGE=upbit &
	@$(MAKE) orderbook TEST_EXCHANGE=upbit &
	@$(MAKE) trade TEST_EXCHANGE=upbit &
	@wait

test-binance-all: ## Binance ëª¨ë“  ë©”ì‹œì§€ íƒ€ì… í…ŒìŠ¤íŠ¸
	@echo "$(GREEN)ğŸŒ Binance ì „ì²´ ë©”ì‹œì§€ íƒ€ì… í…ŒìŠ¤íŠ¸...$(NC)"
	@$(MAKE) ticker TEST_EXCHANGE=binance TEST_REGION=asia &
	@$(MAKE) orderbook TEST_EXCHANGE=binance TEST_REGION=asia &
	@$(MAKE) trade TEST_EXCHANGE=binance TEST_REGION=asia &
	@wait

# ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´ë“¤
perf-test: ## ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ë‹¤ì¤‘ ê±°ë˜ì†Œ + ë‹¤ì¤‘ ë©”ì‹œì§€ íƒ€ì…)
	@echo "$(GREEN)âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘ (2ë¶„ê°„ ì‹¤í–‰)...$(NC)"
	@timeout 120s $(MAKE) korea REQUEST_TYPE=ticker &
	@timeout 120s $(MAKE) asia REQUEST_TYPE=orderbook &
	@timeout 120s $(MAKE) na REQUEST_TYPE=trade &
	@echo "$(YELLOW)ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘... 2ë¶„ í›„ ìë™ ì¢…ë£Œ$(NC)"
	@wait
	@echo "$(GREEN)âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ$(NC)"

# í† í”½ ìƒì„± ëª…ë ¹ì–´ë“¤
create-topics: ## Kafka í† í”½ ìƒì„±
	@echo "$(GREEN)ğŸ“ Kafka í† í”½ ìƒì„±...$(NC)"
	@cd topic_create && $(PYTHON) create_batch_topics.py
	@echo "$(GREEN)âœ… í† í”½ ìƒì„± ì™„ë£Œ$(NC)"

# ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
full-test: ## ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ (í† í”½ ìƒì„± + Consumer ì‹œì‘ + ë°°ì¹˜ í…ŒìŠ¤íŠ¸)
	@echo "$(GREEN)ğŸš€ ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘...$(NC)"
	@$(MAKE) create-topics
	@$(MAKE) consumer-start
	@sleep 5
	@$(MAKE) batch-test
	@$(MAKE) consumer-stop
	@echo "$(GREEN)âœ… ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ$(NC)"

# ë„ì›€ë§ì„ ê¸°ë³¸ íƒ€ê²Ÿìœ¼ë¡œ ì„¤ì •
.DEFAULT_GOAL := help
