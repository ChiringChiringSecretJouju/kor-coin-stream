# ì•”í˜¸í™”í ê±°ë˜ì†Œ ì›¹ì†Œì¼“ ì—°ê²° ìë™í™” Makefile
# 10ê°œ ê±°ë˜ì†Œë¥¼ ì§€ì—­ë³„ë¡œ ë³‘ë ¬ ì‹¤í–‰

.PHONY: help all korea asia na eu clean stop

# ê¸°ë³¸ ì„¤ì •
PYTHON := python
SYMBOLS := BTC,ETH,XRP
REQUEST_TYPE := ticker
SUBSCRIBE_TYPE := ticker

# ìƒ‰ìƒ ì •ì˜
GREEN := \033[0;32m
YELLOW := \033[1;33m
RED := \033[0;31m
NC := \033[0m # No Color

help: ## ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ í‘œì‹œ
	@echo "$(GREEN)ì•”í˜¸í™”í ê±°ë˜ì†Œ ì›¹ì†Œì¼“ ì—°ê²° ìë™í™”$(NC)"
	@echo ""
	@echo "$(YELLOW)ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´:$(NC)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  $(GREEN)%-15s$(NC) %s\n", $$1, $$2}' $(MAKEFILE_LIST)

all: ## ëª¨ë“  ê±°ë˜ì†Œ ì—°ê²° (10ê°œ)
	@echo "$(GREEN)ğŸš€ ëª¨ë“  ê±°ë˜ì†Œ ì—°ê²° ì‹œì‘...$(NC)"
	@$(MAKE) korea &
	@$(MAKE) asia &
	@$(MAKE) na &
	@$(MAKE) eu &
	@echo "$(YELLOW)ëª¨ë“  ì§€ì—­ ë³‘ë ¬ ì‹¤í–‰ ì¤‘... Ctrl+Cë¡œ ì¤‘ë‹¨$(NC)"
	@wait

korea: ## í•œêµ­ ê±°ë˜ì†Œ ì—°ê²° (4ê°œ)
	@echo "$(GREEN)ğŸ‡°ğŸ‡· í•œêµ­ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) upbit &
	@$(MAKE) bithumb &
	@$(MAKE) coinone &
	@$(MAKE) korbit &
	@wait

asia: ## ì•„ì‹œì•„ ê±°ë˜ì†Œ ì—°ê²° (5ê°œ)
	@echo "$(GREEN)ğŸŒ ì•„ì‹œì•„ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) binance &
	@$(MAKE) huobi &
	@$(MAKE) bybit &
	@$(MAKE) gateio &
	@$(MAKE) okx &
	@wait

na: ## ë¶ë¯¸ ê±°ë˜ì†Œ ì—°ê²° (2ê°œ)
	@echo "$(GREEN)ğŸ‡ºğŸ‡¸ ë¶ë¯¸ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) coinbase &
	@$(MAKE) kraken &
	@wait

eu: ## ìœ ëŸ½ ê±°ë˜ì†Œ ì—°ê²° (1ê°œ)
	@echo "$(GREEN)ğŸ‡ªğŸ‡º ìœ ëŸ½ ê±°ë˜ì†Œ ì—°ê²° ì¤‘...$(NC)"
	@$(MAKE) bitfinex

# í•œêµ­ ê±°ë˜ì†Œë“¤
upbit: ## Upbit ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Upbit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

bithumb: ## Bithumb ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Bithumb ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bithumb \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

coinone: ## Coinone ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Coinone ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinone \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

korbit: ## Korbit ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Korbit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange korbit \
		--symbols $(SYMBOLS) \
		--region korea \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

# ì•„ì‹œì•„ ê±°ë˜ì†Œë“¤
binance: ## Binance ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Binance ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange binance \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

huobi: ## Huobi ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Huobi ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange huobi \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

bybit: ## Bybit ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Bybit ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bybit \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

gateio: ## Gate.io ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Gate.io ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange gateio \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

okx: ## OKX ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ OKX ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange okx \
		--symbols $(SYMBOLS) \
		--region asia \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

# ë¶ë¯¸ ê±°ë˜ì†Œë“¤
coinbase: ## Coinbase ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Coinbase ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange coinbase \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

kraken: ## Kraken ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Kraken ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange kraken \
		--symbols $(SYMBOLS) \
		--region na \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

# ìœ ëŸ½ ê±°ë˜ì†Œë“¤
bitfinex: ## Bitfinex ì—°ê²°
	@echo "$(YELLOW)ğŸ“ˆ Bitfinex ì—°ê²° ì¤‘...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange bitfinex \
		--symbols $(SYMBOLS) \
		--region eu \
		--request-type $(REQUEST_TYPE) \
		--subscribe-type $(SUBSCRIBE_TYPE)

# ìœ í‹¸ë¦¬í‹° ëª…ë ¹ì–´ë“¤
test: ## ë‹¨ì¼ ê±°ë˜ì†Œ í…ŒìŠ¤íŠ¸ (Upbit)
	@echo "$(GREEN)ğŸ§ª Upbit í…ŒìŠ¤íŠ¸ ì—°ê²°...$(NC)"
	@$(PYTHON) producer_main.py \
		--exchange upbit \
		--symbols BTC \
		--region korea \
		--request-type ticker \
		--subscribe-type ticker

status: ## Kafka Consumer ìƒíƒœ í™•ì¸
	@echo "$(GREEN)ğŸ“Š Kafka Consumer ìƒíƒœ í™•ì¸...$(NC)"
	@$(PYTHON) main.py &
	@sleep 5
	@pkill -f "python main.py" || true

clean: ## ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬
	@echo "$(RED)ğŸ§¹ ì‹¤í–‰ ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ì •ë¦¬...$(NC)"
	@pkill -f "producer_main.py" || true
	@pkill -f "main.py" || true
	@echo "$(GREEN)âœ… ì •ë¦¬ ì™„ë£Œ$(NC)"

stop: clean ## ëª¨ë“  í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨ (cleanê³¼ ë™ì¼)

# ì„¤ì • ë³€ê²½ ê°€ëŠ¥í•œ íƒ€ê²Ÿë“¤
symbols-btc: ## BTCë§Œ ì—°ê²°
	@$(MAKE) all SYMBOLS=BTC

symbols-major: ## ì£¼ìš” ì½”ì¸ ì—°ê²° (BTC,ETH,XRP)
	@$(MAKE) all SYMBOLS=BTC,ETH,XRP

symbols-all: ## ëª¨ë“  ì½”ì¸ ì—°ê²° (BTC,ETH,XRP,ADA,DOT)
	@$(MAKE) all SYMBOLS=BTC,ETH,XRP,ADA,DOT

# ê°œë°œìš© ëª…ë ¹ì–´ë“¤
dev-korea: ## ê°œë°œìš©: í•œêµ­ ê±°ë˜ì†Œë§Œ ìˆœì°¨ ì‹¤í–‰
	@echo "$(GREEN)ğŸ”§ ê°œë°œ ëª¨ë“œ: í•œêµ­ ê±°ë˜ì†Œ ìˆœì°¨ ì‹¤í–‰$(NC)"
	@$(MAKE) upbit
	@sleep 2
	@$(MAKE) bithumb
	@sleep 2
	@$(MAKE) coinone
	@sleep 2
	@$(MAKE) korbit

dev-test: ## ê°œë°œìš©: ê° ì§€ì—­ë³„ 1ê°œì”©ë§Œ í…ŒìŠ¤íŠ¸
	@echo "$(GREEN)ğŸ”§ ê°œë°œ ëª¨ë“œ: ì§€ì—­ë³„ í…ŒìŠ¤íŠ¸$(NC)"
	@$(MAKE) upbit &
	@$(MAKE) binance &
	@$(MAKE) coinbase &
	@$(MAKE) bitfinex &
	@wait

# ë„ì›€ë§ì„ ê¸°ë³¸ íƒ€ê²Ÿìœ¼ë¡œ ì„¤ì •
.DEFAULT_GOAL := help
